<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Character Viewer</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{
    margin:0;
    min-height:100vh;
    font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;

    background:
        radial-gradient(circle at 20% 20%, #1b2140, transparent 40%),
        radial-gradient(circle at 80% 60%, #16253a, transparent 40%),
        #0f1117;

    color:white;
    padding:30px;
}


/* ================= VIEWER CARD ================= */

.viewer{
    --viewer-bg:#1a1d26;

    background:var(--viewer-bg);
    backdrop-filter: blur(22px) saturate(140%);

    border-radius:28px;
    padding:36px;

    border:1px solid rgba(255,255,255,.06);

    box-shadow:
        0 40px 80px rgba(0,0,0,.45),
        inset 0 1px 0 rgba(255,255,255,.04);

    position:relative;
    overflow:hidden;

    transition:
        background .35s ease,
        color .25s ease,
        box-shadow .25s ease;
}


/* ================= HERO ================= */

.hero{
    display:flex;
    gap:26px;
    align-items:center;
    flex-wrap:wrap;
}

.hero img{
    width:170px;
    height:170px;
    border-radius:50%;
    object-fit:cover;

    box-shadow:
        0 0 0 5px rgba(255,255,255,.05),
        0 20px 50px rgba(0,0,0,.6);
}

.name{
    font-size:36px;
    font-weight:900;
    letter-spacing:.4px;
}

.tags{
    margin-top:8px;
    font-size:14px;
    opacity:.7;
}


/* ================= SECTIONS ================= */

.section{
    margin-top:24px;
    padding:20px;
    border-radius:18px;

    background:rgba(255,255,255,.03);
    border:1px solid rgba(255,255,255,.06);

    backdrop-filter: blur(10px);
}

.section-title{
    font-size:12px;
    letter-spacing:.18em;
    text-transform:uppercase;
    opacity:.55;
    margin-bottom:10px;
}

.section-content{
    font-size:15px;
    line-height:1.65;
}


/* ================= PILLS FIXED ================= */

.relationship-chip{
    display:inline-flex;
    align-items:center;

    padding:7px 14px;
    margin:4px;

    border-radius:999px;

    font-size:13px;
    font-weight:600;

    background:
        linear-gradient(180deg,
            rgba(255,255,255,.12),
            rgba(255,255,255,.03)
        );

    border:1px solid rgba(255,255,255,.15);

    backdrop-filter: blur(8px);

    box-shadow:
        inset 0 1px 0 rgba(255,255,255,.25),
        0 6px 16px rgba(0,0,0,.35);

    transition:.2s;
}

.relationship-chip:hover{
    transform:translateY(-1px);
}


/* ================= BUTTON ================= */

.downloadBtn{
    margin-top:30px;
    width:100%;
    padding:16px;

    border:none;
    border-radius:16px;

    background:linear-gradient(135deg,#5aa2ff,#7ab6ff);

    color:white;
    font-size:16px;
    font-weight:700;

    cursor:pointer;

    box-shadow:0 14px 40px rgba(90,162,255,.35);
    transition:.2s;
}

.downloadBtn:hover{
    transform:translateY(-2px);
}


/* ================= EFFECTS ================= */

/* NOISE */
.viewer.noise::before{
    content:"";
    position:absolute;
    inset:0;
    opacity:.08;
    pointer-events:none;
    background-image:url("https://grainy-gradients.vercel.app/noise.svg");
}

/* GLOW */
.viewer.glow::before{
    content:"";
    position:absolute;
    inset:-40%;
    pointer-events:none;
    background:
        radial-gradient(circle at center,
        rgba(255,255,255,.18),
        transparent 60%);
}

/* PARTICLES */
.viewer.particles::after{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;

    background-image:
        radial-gradient(circle, rgba(255,255,255,.09) 1px, transparent 1px);
    background-size:60px 60px;

    animation:particleMove 40s linear infinite;
}

@keyframes particleMove{
    from{ background-position:0 0; }
    to{ background-position:600px 600px; }
}

</style>
</head>

<body>
    
    <!-- BODY -->
    
    
<div style="max-width:780px;margin:auto;margin-bottom:20px;">

    <label>Background Color</label>

    <div style="display:flex; gap:10px; margin-top:6px;">
        <input type="color" id="bgColorPicker" value="#1a1d26">

        <input type="text"
               id="bgHexInput"
               placeholder="#1a1d26"
               style="flex:1;">
    </div>

</div>

<div class="bgPanel">

    <h3>Background Builder</h3>

    <div class="bgRow">
        <label>Color A</label>
        <input type="color" id="gradA" value="#1a1d26">
        <input type="text" id="gradAHex" placeholder="#1a1d26">
    </div>

    <div class="bgRow">
        <label>Color B</label>
        <input type="color" id="gradB" value="#5aa2ff">
        <input type="text" id="gradBHex" placeholder="#5aa2ff">
    </div>

    <div class="bgRow">
        <label>Angle</label>
        <input type="range" id="gradAngle" min="0" max="360" value="135">
        <span id="angleLabel">135°</span>
    </div>

    <h3>Effects</h3>

    <label><input type="checkbox" id="noiseToggle"> Noise Texture</label>
    <label><input type="checkbox" id="glowToggle"> Glow Vignette</label>
    <label><input type="checkbox" id="particleToggle"> Particle Shimmer</label>

</div>


<div class="viewer" id="viewerCard">

    <div class="hero">
        <img id="vImage">

        <div class="hero-text">
            <div class="name" id="vName"></div>
            <div class="tags" id="vTags"></div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Description</div>
        <div class="section-content" id="vDesc"></div>
    </div>

    <div class="section">
        <div class="section-title">Lore</div>
        <div class="section-content" id="vLore"></div>
    </div>

    <div class="section">
        <div class="section-title">Life Data</div>
        <div class="section-content" id="vLife"></div>
    </div>

    <div class="section">
        <div class="section-title">Relationships</div>
        <div class="section-content" id="vRelationships"></div>
    </div>

</div>

<button id="downloadBtn" class="downloadBtn">
Download Character PNG
</button>


<!-- JAVASCRIPT -->

<script>
const chars = JSON.parse(localStorage.getItem("characters")) || [];
const index = localStorage.getItem("viewingCharacterIndex");
const char = chars[index];

if(!char){
    alert("Character not found");
    location.href = "character.html";
}


const vImage = document.getElementById("vImage");
const vName = document.getElementById("vName");
const vDesc = document.getElementById("vDesc");
const vTags = document.getElementById("vTags");
const vLore = document.getElementById("vLore");
const vLife = document.getElementById("vLife");
const vRelationships = document.getElementById("vRelationships");
const downloadBtn = document.getElementById("downloadBtn");


vImage.src = char.image || "";
vName.textContent = char.name || "Unnamed";
vDesc.textContent = char.desc || "-";
vTags.textContent = char.tags || "-";

vLore.innerHTML = `
Species: ${char.species || "-"}<br>
Faction: ${char.faction || "-"}<br>
Origin: ${char.origin || "-"}<br>
Alignment: ${char.alignment || "-"}
`;

vLife.innerHTML = `
Birth: ${char.birthDate || "-"}<br>
Death: ${char.deathDate || "Alive"}<br>
Status: ${char.status || "-"}<br>
Age: ${char.age || "-"}
`;


vRelationships.innerHTML = (char.relationships || [])
.map(r => `<span class="relationship-chip">${r.name} — ${r.type}</span>`)
.join("") || "None";


/* DOWNLOAD PNG */

downloadBtn.onclick = async () => {

    const computed = getComputedStyle(viewer);
    const originalBg = viewer.style.background;

    /* Force solid fallback if gradient */
    if(computed.backgroundImage !== "none"){
        viewer.style.background = computed.backgroundColor || "#1a1d26";
    }

    const canvas = await html2canvas(viewer, {
        backgroundColor: null,
        useCORS: true
    });

    viewer.style.background = originalBg;

    const link = document.createElement("a");
    link.download = (char.name || "character") + ".png";
    link.href = canvas.toDataURL("image/png");
    link.click();
};


/* ================ COLOR DETECTORS =================*/

const picker = document.getElementById("bgColorPicker");
const hexInput = document.getElementById("bgHexInput");
const viewer = document.getElementById("viewerCard");

/* HEX → RGB */
function hexToRgb(hex){

    hex = hex.replace("#","");

    if(hex.length === 3){
        hex = hex.split("").map(c => c+c).join("");
    }

    const num = parseInt(hex, 16);

    return {
        r:(num >> 16) & 255,
        g:(num >> 8) & 255,
        b:num & 255
    };
}

/* BRIGHTNESS DETECTOR */
function getBrightness({r,g,b}){
    return (r*299 + g*587 + b*114) / 1000;
}

/* APPLY BACKGROUND + AUTO TEXT */
function applyBackground(hex){

    if(!hex.startsWith("#")) hex = "#"+hex;

    viewer.style.setProperty("--viewer-bg", hex);

    const rgb = hexToRgb(hex);
    const brightness = getBrightness(rgb);

    if(brightness > 150){
        viewer.style.color = "#111";
    }else{
        viewer.style.color = "#fff";
    }
}


/* PICKER → HEX */
picker.addEventListener("input", ()=>{
    hexInput.value = picker.value;
    applyBackground(picker.value);
});

/* HEX → PICKER */
hexInput.addEventListener("input", ()=>{

    let val = hexInput.value.trim();

    if(!val.startsWith("#")) val = "#"+val;

    if(/^#[0-9A-F]{6}$/i.test(val)){
        picker.value = val;
        applyBackground(val);
    }
});


/* ======================= GRADIENT ENGINE ====================== */

const gradA = document.getElementById("gradA");
const gradB = document.getElementById("gradB");
const gradAHex = document.getElementById("gradAHex");
const gradBHex = document.getElementById("gradBHex");
const gradAngle = document.getElementById("gradAngle");
const angleLabel = document.getElementById("angleLabel");

function applyGradient(){

    const a = gradA.value;
    const b = gradB.value;
    const angle = gradAngle.value;

    viewer.style.setProperty(
        "--viewer-bg",
        `linear-gradient(${angle}deg, ${a}, ${b})`
    );

    autoTextFromGradient(a, b);
}

gradA.oninput = ()=> {
    gradAHex.value = gradA.value;
    applyGradient();
};

gradB.oninput = ()=> {
    gradBHex.value = gradB.value;
    applyGradient();
};

gradAngle.oninput = ()=>{
    angleLabel.textContent = gradAngle.value + "°";
    applyGradient();
};


/* TEXT DETECTION */

function autoTextFromGradient(hexA, hexB){

    const rgbA = hexToRgb(hexA);
    const rgbB = hexToRgb(hexB);

    const avg = {
        r:(rgbA.r + rgbB.r)/2,
        g:(rgbA.g + rgbB.g)/2,
        b:(rgbA.b + rgbB.b)/2
    };

    const brightness = getBrightness(avg);

    viewer.style.color = brightness > 150 ? "#111" : "#fff";
}

gradAHex.addEventListener("input", ()=>{
    let val = gradAHex.value.trim();

    if(!val.startsWith("#")) val = "#"+val;

    if(/^#[0-9A-F]{6}$/i.test(val)){
        gradA.value = val;
        applyGradient();
        
   if(val.length < 7) return;

    }
});

gradAHex.addEventListener("input", ()=>{
    let val = gradAHex.value.trim();

    if(val.length < 7) return;

    if(!val.startsWith("#")) val = "#"+val;

    if(/^#[0-9A-F]{6}$/i.test(val)){
        gradA.value = val;
        applyGradient();
    }
});



/* ============== EFFECT TOGGLE =============== */

const noiseToggle = document.getElementById("noiseToggle");
const glowToggle = document.getElementById("glowToggle");
const particleToggle = document.getElementById("particleToggle");

noiseToggle.onchange = ()=>{
    viewer.classList.toggle("noise", noiseToggle.checked);
};

glowToggle.onchange = ()=>{
    viewer.classList.toggle("glow", glowToggle.checked);
};

particleToggle.onchange = ()=>{
    viewer.classList.toggle("particles", particleToggle.checked);
};




</script>

</body>
</html>
